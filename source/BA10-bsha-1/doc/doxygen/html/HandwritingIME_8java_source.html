<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BA10-bsha-1: /media/Daten/Studium/BA/source/BA10-bsha-1/src/ch/zhaw/ba10_bsha_1/ime/HandwritingIME.java Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>/media/Daten/Studium/BA/source/BA10-bsha-1/src/ch/zhaw/ba10_bsha_1/ime/HandwritingIME.java</h1><a href="HandwritingIME_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="keyword">package </span>ch.zhaw.ba10_bsha_1.ime;
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="keyword">import</span> android.app.Service;
<a name="l00005"></a>00005 <span class="keyword">import</span> android.content.ComponentName;
<a name="l00006"></a>00006 <span class="keyword">import</span> android.content.Context;
<a name="l00007"></a>00007 <span class="keyword">import</span> android.content.Intent;
<a name="l00008"></a>00008 <span class="keyword">import</span> android.content.ServiceConnection;
<a name="l00009"></a>00009 <span class="keyword">import</span> android.inputmethodservice.InputMethodService;
<a name="l00010"></a>00010 <span class="keyword">import</span> android.inputmethodservice.Keyboard;
<a name="l00011"></a>00011 <span class="keyword">import</span> android.inputmethodservice.KeyboardView;
<a name="l00012"></a>00012 <span class="keyword">import</span> android.os.Handler;
<a name="l00013"></a>00013 <span class="keyword">import</span> android.os.IBinder;
<a name="l00014"></a>00014 <span class="keyword">import</span> android.os.Message;
<a name="l00015"></a>00015 <span class="keyword">import</span> android.os.RemoteException;
<a name="l00016"></a>00016 <span class="keyword">import</span> android.text.method.MetaKeyKeyListener;
<a name="l00017"></a>00017 <span class="keyword">import</span> android.util.Log;
<a name="l00018"></a>00018 <span class="keyword">import</span> android.view.KeyCharacterMap;
<a name="l00019"></a>00019 <span class="keyword">import</span> android.view.KeyEvent;
<a name="l00020"></a>00020 <span class="keyword">import</span> android.view.View;
<a name="l00021"></a>00021 <span class="keyword">import</span> android.view.inputmethod.CompletionInfo;
<a name="l00022"></a>00022 <span class="keyword">import</span> android.view.inputmethod.EditorInfo;
<a name="l00023"></a>00023 <span class="keyword">import</span> android.view.inputmethod.InputConnection;
<a name="l00024"></a>00024 <span class="keyword">import</span> android.widget.Toast;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">import</span> java.util.ArrayList;
<a name="l00027"></a>00027 <span class="keyword">import</span> java.util.List;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="keyword">import</span> ch.zhaw.ba10_bsha_1.Character;
<a name="l00030"></a>00030 <span class="keyword">import</span> ch.zhaw.ba10_bsha_1.R;
<a name="l00031"></a>00031 <span class="keyword">import</span> ch.zhaw.ba10_bsha_1.StrategyArgument;
<a name="l00032"></a>00032 <span class="keyword">import</span> ch.zhaw.ba10_bsha_1.TouchPoint;
<a name="l00033"></a>00033 <span class="keyword">import</span> ch.zhaw.ba10_bsha_1.service.DetectionService;
<a name="l00034"></a>00034 <span class="keyword">import</span> ch.zhaw.ba10_bsha_1.service.IDetectionService;
<a name="l00035"></a>00035 <span class="keyword">import</span> ch.zhaw.ba10_bsha_1.service.IReturnResults;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 
<a name="l00045"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html">00045</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html">HandwritingIME</a> <span class="keyword">extends</span> InputMethodService implements KeyboardView.OnKeyboardActionListener, <a class="code" href="interfacech_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1IObserver.html">IObserver</a> {
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 
<a name="l00048"></a>00048         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00049"></a>00049         <span class="comment">// Inner Class</span>
<a name="l00050"></a>00050         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052     
<a name="l00056"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME_1_1DetectionServiceConnection.html">00056</a>     <span class="keyword">class </span><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME_1_1DetectionServiceConnection.html">DetectionServiceConnection</a> <span class="keyword">implements</span> ServiceConnection {
<a name="l00061"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME_1_1DetectionServiceConnection.html#a84e859d739686eac5aef4cb854f96383">00061</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME_1_1DetectionServiceConnection.html#a84e859d739686eac5aef4cb854f96383">onServiceConnected</a>(ComponentName className, IBinder service) {
<a name="l00062"></a>00062                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a> = IDetectionService.Stub.asInterface(service);
<a name="l00063"></a>00063             <span class="keywordflow">try</span> {
<a name="l00064"></a>00064                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a>.registerCallback(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a2b00011a3695bc66257dd90aa0ac27ab">serviceCallback</a>);
<a name="l00065"></a>00065             } <span class="keywordflow">catch</span> (RemoteException e) {}
<a name="l00066"></a>00066             Toast.makeText(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html">HandwritingIME</a>.this, R.string.service_bound, Toast.LENGTH_SHORT).show();
<a name="l00067"></a>00067         }
<a name="l00068"></a>00068 
<a name="l00072"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME_1_1DetectionServiceConnection.html#a987af315419dc97936af4b55375cd03b">00072</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME_1_1DetectionServiceConnection.html#a987af315419dc97936af4b55375cd03b">onServiceDisconnected</a>(ComponentName className) {
<a name="l00073"></a>00073             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a> = null;
<a name="l00074"></a>00074             Toast.makeText(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html">HandwritingIME</a>.this, R.string.service_unbound, Toast.LENGTH_SHORT).show();
<a name="l00075"></a>00075         }
<a name="l00076"></a>00076     };
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00080"></a>00080         <span class="comment">// Attributes</span>
<a name="l00081"></a>00081         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     
<a name="l00084"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a6807180ab4641e86ea2c94e01ead09a8">00084</a>     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a6807180ab4641e86ea2c94e01ead09a8">PROCESS_HARD_KEYS</a> = <span class="keyword">true</span>;
<a name="l00085"></a>00085     
<a name="l00086"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">00086</a>     <span class="keyword">private</span> IDetectionService <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a> = null;
<a name="l00087"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a327839f818f5782ff037e64ff386045f">00087</a>     <span class="keyword">private</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME_1_1DetectionServiceConnection.html">DetectionServiceConnection</a> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a327839f818f5782ff037e64ff386045f">serviceConnection</a>;
<a name="l00088"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a9d9ecc20c8af30a04dfaa832cd7da89b">00088</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a9d9ecc20c8af30a04dfaa832cd7da89b">serviceIsBound</a> = <span class="keyword">false</span>;
<a name="l00089"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a2ec39f4494a222882ffb6a09419accd8">00089</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a2ec39f4494a222882ffb6a09419accd8">serviceIsRunning</a> = <span class="keyword">false</span>;
<a name="l00090"></a>00090     
<a name="l00091"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">00091</a>     <span class="keyword">private</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1PadView.html">PadView</a> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>;
<a name="l00092"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a25083961cde3a46e105a3ad13c0f557b">00092</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a25083961cde3a46e105a3ad13c0f557b">sendFieldHeight</a> = <span class="keyword">false</span>;
<a name="l00093"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af7d4919c3faf26a9459310f8102d4d80">00093</a>     <span class="keyword">private</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1CandidateView.html">CandidateView</a> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af7d4919c3faf26a9459310f8102d4d80">candidateView</a>;
<a name="l00094"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a8df4f47c35084abc7bf31d65b248c5be">00094</a>     <span class="keyword">private</span> CompletionInfo[] <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a8df4f47c35084abc7bf31d65b248c5be">completions</a>;
<a name="l00095"></a>00095     
<a name="l00096"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">00096</a>     <span class="keyword">private</span> StringBuilder <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a> = <span class="keyword">new</span> StringBuilder();
<a name="l00097"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a84134f9987fa827825135caaac882b26">00097</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a84134f9987fa827825135caaac882b26">predictionOn</a>;
<a name="l00098"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ab1ce22088e636ff9cd28e7c5d062471a">00098</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ab1ce22088e636ff9cd28e7c5d062471a">completionOn</a>;
<a name="l00099"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5fcd0c226a96c4fb7549fba822b49d2a">00099</a>     <span class="keyword">private</span> <span class="keywordtype">long</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5fcd0c226a96c4fb7549fba822b49d2a">metaState</a>;
<a name="l00100"></a>00100     
<a name="l00101"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a57cdeb14386f227d3588cf221f32e8d0">00101</a>     <span class="keyword">private</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1LatinKeyboard.html">LatinKeyboard</a> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a57cdeb14386f227d3588cf221f32e8d0">padKeyboard</a>;
<a name="l00102"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ac95c3e131d61264247ea2f40b3bd4991">00102</a>     <span class="keyword">private</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1LatinKeyboard.html">LatinKeyboard</a> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ac95c3e131d61264247ea2f40b3bd4991">curKeyboard</a>;
<a name="l00103"></a>00103     
<a name="l00104"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a23ac28ca44ad5920e88c7671b7a9f2d1">00104</a>     <span class="keyword">private</span> String <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a23ac28ca44ad5920e88c7671b7a9f2d1">wordSeparators</a>;
<a name="l00105"></a>00105     
<a name="l00106"></a>00106 
<a name="l00107"></a>00107         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00108"></a>00108         <span class="comment">// Initialization methods</span>
<a name="l00109"></a>00109         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     
<a name="l00115"></a>00115     @Override
<a name="l00116"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a391f1eb148d1c08e456d1595516c158c">00116</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a391f1eb148d1c08e456d1595516c158c">onCreate</a>() {
<a name="l00117"></a>00117         super.onCreate();
<a name="l00118"></a>00118         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a327839f818f5782ff037e64ff386045f">serviceConnection</a> = <span class="keyword">new</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME_1_1DetectionServiceConnection.html">DetectionServiceConnection</a>();
<a name="l00119"></a>00119         <span class="keywordflow">if</span> (!<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a2ec39f4494a222882ffb6a09419accd8">serviceIsRunning</a>) {
<a name="l00120"></a>00120             Toast.makeText(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html">HandwritingIME</a>.this, R.string.service_starting, Toast.LENGTH_SHORT).show();
<a name="l00121"></a>00121                 startService(<span class="keyword">new</span> Intent(<span class="stringliteral">&quot;ch.zhaw.ba10_bsha_1.DETECTION_SERVICE&quot;</span>));
<a name="l00122"></a>00122                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a2ec39f4494a222882ffb6a09419accd8">serviceIsRunning</a> = <span class="keyword">true</span>;
<a name="l00123"></a>00123         }
<a name="l00124"></a>00124         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a23ac28ca44ad5920e88c7671b7a9f2d1">wordSeparators</a> = getResources().getString(R.string.word_separators);
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126     
<a name="l00130"></a>00130     @Override
<a name="l00131"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a113e6d863b481e5a9c926dd917d7822a">00131</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a113e6d863b481e5a9c926dd917d7822a">onInitializeInterface</a>() {
<a name="l00132"></a>00132         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a> = (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1PadView.html">PadView</a>) getLayoutInflater().inflate(R.layout.input, null);
<a name="l00133"></a>00133         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.setMinimumWidth(getMaxWidth());
<a name="l00134"></a>00134                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1PadView.html#a4969dbd30351775211919860ef1f8643">attachObserver</a>(<span class="keyword">this</span>);
<a name="l00135"></a>00135         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a57cdeb14386f227d3588cf221f32e8d0">padKeyboard</a> = <span class="keyword">new</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1LatinKeyboard.html">LatinKeyboard</a>(<span class="keyword">this</span>, R.xml.pad);
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137     
<a name="l00144"></a>00144     @Override
<a name="l00145"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a920e8e85634fc64519604846302aaa58">00145</a>     <span class="keyword">public</span> View <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a920e8e85634fc64519604846302aaa58">onCreateInputView</a>() {
<a name="l00146"></a>00146                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.setOnKeyboardActionListener(<span class="keyword">this</span>);
<a name="l00147"></a>00147                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.setKeyboard(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a57cdeb14386f227d3588cf221f32e8d0">padKeyboard</a>);
<a name="l00148"></a>00148         <span class="keywordflow">return</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>;
<a name="l00149"></a>00149     }
<a name="l00150"></a>00150     
<a name="l00151"></a>00151 
<a name="l00152"></a>00152         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00153"></a>00153         <span class="comment">// Implementation of the InputMethodService methods (partially)</span>
<a name="l00154"></a>00154         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     
<a name="l00160"></a>00160     @Override
<a name="l00161"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a731678d503654a151a2204665ec2f018">00161</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a731678d503654a151a2204665ec2f018">onStartInputView</a>(EditorInfo attribute, <span class="keywordtype">boolean</span> restarting) {
<a name="l00162"></a>00162         super.onStartInputView(attribute, restarting);
<a name="l00163"></a>00163         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a9d9ecc20c8af30a04dfaa832cd7da89b">serviceIsBound</a> =  bindService(<span class="keyword">new</span> Intent(IDetectionService.class.getName()), <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a327839f818f5782ff037e64ff386045f">serviceConnection</a>, Context.BIND_AUTO_CREATE);
<a name="l00164"></a>00164         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.setKeyboard(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ac95c3e131d61264247ea2f40b3bd4991">curKeyboard</a>);
<a name="l00165"></a>00165         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1PadView.html#a4e5d62bdc50d1efae84f0cde40beeb51">closing</a>();
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167     
<a name="l00172"></a>00172     @Override
<a name="l00173"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a35c873d879f2440e2a98e2dbca31202f">00173</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a35c873d879f2440e2a98e2dbca31202f">onDestroy</a>() {
<a name="l00174"></a>00174         super.onDestroy();
<a name="l00175"></a>00175         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a9d9ecc20c8af30a04dfaa832cd7da89b">serviceIsBound</a>) {
<a name="l00176"></a>00176             <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a> != null) {
<a name="l00177"></a>00177                 <span class="keywordflow">try</span> {
<a name="l00178"></a>00178                     <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a>.unregisterCallback(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a2b00011a3695bc66257dd90aa0ac27ab">serviceCallback</a>);
<a name="l00179"></a>00179                 } <span class="keywordflow">catch</span> (RemoteException e) {}
<a name="l00180"></a>00180             }
<a name="l00181"></a>00181             <span class="comment">// Detach our existing connection.</span>
<a name="l00182"></a>00182             unbindService(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a327839f818f5782ff037e64ff386045f">serviceConnection</a>);
<a name="l00183"></a>00183             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a9d9ecc20c8af30a04dfaa832cd7da89b">serviceIsBound</a> = <span class="keyword">false</span>;
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 
<a name="l00188"></a>00188         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00189"></a>00189         <span class="comment">// Implementation of the IObserver interface</span>
<a name="l00190"></a>00190         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     
<a name="l00196"></a>00196         @Override
<a name="l00197"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a788cf4563e1480f6c3ea3ca6f07b2623">00197</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a788cf4563e1480f6c3ea3ca6f07b2623">update</a>(<a class="code" href="interfacech_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1IObservable.html">IObservable</a> updater) {
<a name="l00198"></a>00198                 <span class="keywordflow">if</span> (updater instanceof <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1PadView.html">PadView</a>) {
<a name="l00199"></a>00199                         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a9d9ecc20c8af30a04dfaa832cd7da89b">serviceIsBound</a> &amp;&amp; (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a> != null)) {
<a name="l00200"></a>00200                                 <span class="keywordflow">try</span> {
<a name="l00201"></a>00201                                         InputConnection ic = getCurrentInputConnection();
<a name="l00202"></a>00202                                         <span class="keywordflow">switch</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1PadView.html#acea9e02a6fe22cd86a909dcd20de83f0">getEventType</a>()) {
<a name="l00203"></a>00203                                                 <span class="keywordflow">case</span> PadView.EVENT_TYPE_NEW_POINTS :
<a name="l00204"></a>00204                                                         <span class="keywordflow">if</span> (!<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a25083961cde3a46e105a3ad13c0f557b">sendFieldHeight</a>) {
<a name="l00205"></a>00205                                                         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1StrategyArgument.html">StrategyArgument</a> arg = <span class="keyword">new</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1StrategyArgument.html">StrategyArgument</a>(<span class="stringliteral">&quot;FieldHeight&quot;</span>, Integer.valueOf(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.getHeight()).toString());
<a name="l00206"></a>00206                                                                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a>.broadcastArgument(arg);
<a name="l00207"></a>00207                                                                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a25083961cde3a46e105a3ad13c0f557b">sendFieldHeight</a> = <span class="keyword">true</span>;
<a name="l00208"></a>00208                                                         }
<a name="l00209"></a>00209                                                         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a>.addTouchPoints(<span class="keyword">new</span> ArrayList&lt;TouchPoint&gt;(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1PadView.html#aea9a4c4f77ccfdfddfad16cdcc200107">getLastPoints</a>()), <span class="keyword">false</span>);
<a name="l00210"></a>00210                                                         <span class="keywordflow">break</span>;
<a name="l00211"></a>00211                                                 <span class="keywordflow">case</span> PadView.EVENT_TYPE_TOUCH_UP :
<a name="l00212"></a>00212                                                         <span class="keywordflow">if</span> (!<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a25083961cde3a46e105a3ad13c0f557b">sendFieldHeight</a>) {
<a name="l00213"></a>00213                                                         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1StrategyArgument.html">StrategyArgument</a> arg = <span class="keyword">new</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1StrategyArgument.html">StrategyArgument</a>(<span class="stringliteral">&quot;FieldHeight&quot;</span>, Integer.valueOf(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.getHeight()).toString());
<a name="l00214"></a>00214                                                                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a>.broadcastArgument(arg);
<a name="l00215"></a>00215                                                                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a25083961cde3a46e105a3ad13c0f557b">sendFieldHeight</a> = <span class="keyword">true</span>;
<a name="l00216"></a>00216                                                         }
<a name="l00217"></a>00217                                                         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1PadView.html#aea9a4c4f77ccfdfddfad16cdcc200107">getLastPoints</a>() != null) {
<a name="l00218"></a>00218                                                                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a>.addTouchPoints(<span class="keyword">new</span> ArrayList&lt;TouchPoint&gt;(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1PadView.html#aea9a4c4f77ccfdfddfad16cdcc200107">getLastPoints</a>()), <span class="keyword">true</span>);
<a name="l00219"></a>00219                                                         } <span class="keywordflow">else</span> {
<a name="l00220"></a>00220                                                                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb6575df144036d95d8e2fb029218c4d">detectionService</a>.endSample();
<a name="l00221"></a>00221                                                         }
<a name="l00222"></a>00222                                                         <span class="keywordflow">break</span>;
<a name="l00223"></a>00223                                                 <span class="keywordflow">case</span> PadView.EVENT_TYPE_SPACE :
<a name="l00224"></a>00224                                                         ic.commitText(<span class="stringliteral">&quot; &quot;</span>, 1);
<a name="l00225"></a>00225                                                         <span class="keywordflow">break</span>;
<a name="l00226"></a>00226                                                 <span class="keywordflow">case</span> PadView.EVENT_TYPE_BACKSPACE :
<a name="l00227"></a>00227                                                         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a629b38e45bc795d46cb7ce1c79bc1def">handleBackspace</a>();
<a name="l00228"></a>00228                                                         <span class="keywordflow">break</span>;
<a name="l00229"></a>00229                                                 <span class="keywordflow">default</span> :
<a name="l00230"></a>00230                                                         <span class="keywordflow">break</span>;
<a name="l00231"></a>00231                                         }
<a name="l00232"></a>00232                                 } <span class="keywordflow">catch</span> (RemoteException ex) {}
<a name="l00233"></a>00233                         }
<a name="l00234"></a>00234                 }
<a name="l00235"></a>00235         }
<a name="l00236"></a>00236         
<a name="l00237"></a>00237 
<a name="l00238"></a>00238         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00239"></a>00239         <span class="comment">// Deal with callbacks</span>
<a name="l00240"></a>00240         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     
<a name="l00243"></a>00243         
<a name="l00247"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a2b00011a3695bc66257dd90aa0ac27ab">00247</a>     <span class="keyword">private</span> IReturnResults <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a2b00011a3695bc66257dd90aa0ac27ab">serviceCallback</a> = <span class="keyword">new</span> IReturnResults.Stub() {
<a name="l00248"></a>00248                 @Override
<a name="l00249"></a>00249                 <span class="keyword">public</span> <span class="keywordtype">void</span> recognisedCharacters(List&lt;ch.zhaw.ba10_bsha_1.Character&gt; characters) <span class="keywordflow">throws</span> RemoteException {
<a name="l00250"></a>00250                         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3c53e6e79323d1574d50d493d76f290d">serviceHandler</a>.sendMessage(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3c53e6e79323d1574d50d493d76f290d">serviceHandler</a>.obtainMessage(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af6448d252df45f5e4ea520c29ec38d0b">CHARACTER_RESULT_MSG</a>, characters));
<a name="l00251"></a>00251                 }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253                 @Override
<a name="l00254"></a>00254                 <span class="keyword">public</span> <span class="keywordtype">void</span> recognisedChar(<span class="keywordtype">char</span> character, <span class="keywordtype">float</span> probability) <span class="keywordflow">throws</span> RemoteException {
<a name="l00255"></a>00255                         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3c53e6e79323d1574d50d493d76f290d">serviceHandler</a>.sendMessage(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3c53e6e79323d1574d50d493d76f290d">serviceHandler</a>.obtainMessage(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a4a5e59ff77bc147c35c6cc423e878305">CHAR_RESULT_MSG</a>, character, Math.round(probability * 1000000)));
<a name="l00256"></a>00256                 }
<a name="l00257"></a>00257     };
<a name="l00258"></a>00258     
<a name="l00259"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af6448d252df45f5e4ea520c29ec38d0b">00259</a>     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">int</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af6448d252df45f5e4ea520c29ec38d0b">CHARACTER_RESULT_MSG</a> = 1;
<a name="l00260"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a4a5e59ff77bc147c35c6cc423e878305">00260</a>     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">int</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a4a5e59ff77bc147c35c6cc423e878305">CHAR_RESULT_MSG</a>  = 2;
<a name="l00261"></a>00261     
<a name="l00262"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3c53e6e79323d1574d50d493d76f290d">00262</a>     <span class="keyword">private</span> Handler <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3c53e6e79323d1574d50d493d76f290d">serviceHandler</a> = <span class="keyword">new</span> Handler() {
<a name="l00263"></a>00263         
<a name="l00264"></a>00264         @SuppressWarnings(<span class="stringliteral">&quot;unchecked&quot;</span>)
<a name="l00265"></a>00265                 @Override
<a name="l00266"></a>00266         <span class="keyword">public</span> <span class="keywordtype">void</span> handleMessage(Message msg) {
<a name="l00267"></a>00267             <span class="keywordflow">switch</span> (msg.what) {
<a name="l00268"></a>00268                 <span class="comment">// Most used case: Retrieving one or more Characters as a List</span>
<a name="l00269"></a>00269                 <span class="keywordflow">case</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af6448d252df45f5e4ea520c29ec38d0b">CHARACTER_RESULT_MSG</a>:
<a name="l00270"></a>00270                         ArrayList&lt;Character&gt; chars = (ArrayList&lt;Character&gt;) msg.obj;
<a name="l00271"></a>00271                         if (chars.size() &gt; 0) {
<a name="l00272"></a>00272                                 InputConnection conn = getCurrentInputConnection();
<a name="l00273"></a>00273                                 StringBuffer text = <span class="keyword">new</span> StringBuffer();
<a name="l00274"></a>00274                                 <span class="keywordflow">for</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1Character.html">Character</a> character : chars) {
<a name="l00275"></a>00275                                         <span class="keywordflow">if</span> (!character.toString().startsWith(<span class="stringliteral">&quot;none&quot;</span>)) {
<a name="l00276"></a>00276                                                 text.append(character.getDetectedCharacter());
<a name="l00277"></a>00277                                         }
<a name="l00278"></a>00278                                                 }
<a name="l00279"></a>00279                                 conn.commitText(text, 1);
<a name="l00280"></a>00280                         }
<a name="l00281"></a>00281                     <span class="keywordflow">break</span>;
<a name="l00282"></a>00282                 <span class="comment">// Backup case: Retrieving a single char and its probability (MircoGestures are lost)</span>
<a name="l00283"></a>00283                 <span class="keywordflow">case</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a4a5e59ff77bc147c35c6cc423e878305">CHAR_RESULT_MSG</a>:
<a name="l00284"></a>00284                         <span class="keywordtype">char</span> recogn_char = (char) msg.arg1;
<a name="l00285"></a>00285                         <span class="keywordtype">float</span> prob = (<span class="keywordtype">float</span>) (msg.arg2 / 1000000.0);
<a name="l00286"></a>00286                         <span class="keywordflow">if</span> (recogn_char != <span class="charliteral">&apos;\0&apos;</span>) {
<a name="l00287"></a>00287                                 InputConnection conn = getCurrentInputConnection();
<a name="l00288"></a>00288                                 StringBuffer text = <span class="keyword">new</span> StringBuffer();
<a name="l00289"></a>00289                                 text.append(recogn_char);
<a name="l00290"></a>00290                                 conn.commitText(text, 1);
<a name="l00291"></a>00291                                 Log.i(<span class="stringliteral">&quot;HandwritingIME&quot;</span>, <span class="stringliteral">&quot;Received detected character: \&apos;&quot;</span> + text + <span class="stringliteral">&quot;\&apos; with a probability of &quot;</span> + prob);
<a name="l00292"></a>00292                         }
<a name="l00293"></a>00293                     <span class="keywordflow">break</span>;
<a name="l00294"></a>00294                 <span class="keywordflow">default</span>:
<a name="l00295"></a>00295                     super.handleMessage(msg);
<a name="l00296"></a>00296             }
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298     };
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     
<a name="l00302"></a>00302         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00303"></a>00303         <span class="comment">// Further legacy stuff for the input method</span>
<a name="l00304"></a>00304         <span class="comment">//---------------------------------------------------------------------------</span>
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 
<a name="l00311"></a>00311     @Override
<a name="l00312"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a478af9d9f8258613e4e124bdfdd8dc09">00312</a>     <span class="keyword">public</span> View <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a478af9d9f8258613e4e124bdfdd8dc09">onCreateCandidatesView</a>() {
<a name="l00313"></a>00313         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af7d4919c3faf26a9459310f8102d4d80">candidateView</a> = <span class="keyword">new</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1CandidateView.html">CandidateView</a>(<span class="keyword">this</span>);
<a name="l00314"></a>00314         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af7d4919c3faf26a9459310f8102d4d80">candidateView</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1CandidateView.html#ae5104c93fe283ac8ea6fa057ce007bc9">setService</a>(<span class="keyword">this</span>);
<a name="l00315"></a>00315         <span class="keywordflow">return</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af7d4919c3faf26a9459310f8102d4d80">candidateView</a>;
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317 
<a name="l00324"></a>00324     @Override
<a name="l00325"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#abb0bfa8e1c7857a88657e6640855af0f">00325</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#abb0bfa8e1c7857a88657e6640855af0f">onStartInput</a>(EditorInfo attribute, <span class="keywordtype">boolean</span> restarting) {
<a name="l00326"></a>00326         super.onStartInput(attribute, restarting);
<a name="l00327"></a>00327         
<a name="l00328"></a>00328         <span class="comment">// Reset our state.  We want to do this even if restarting, because</span>
<a name="l00329"></a>00329         <span class="comment">// the underlying state of the text editor could have changed in any way.</span>
<a name="l00330"></a>00330         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.setLength(0);
<a name="l00331"></a>00331         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a428fc59e616bef0e75c866ddece97a70">updateCandidates</a>();
<a name="l00332"></a>00332         
<a name="l00333"></a>00333         <span class="keywordflow">if</span> (!restarting) {
<a name="l00334"></a>00334             <span class="comment">// Clear shift states.</span>
<a name="l00335"></a>00335             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5fcd0c226a96c4fb7549fba822b49d2a">metaState</a> = 0;
<a name="l00336"></a>00336         }
<a name="l00337"></a>00337         
<a name="l00338"></a>00338         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a84134f9987fa827825135caaac882b26">predictionOn</a> = <span class="keyword">false</span>;
<a name="l00339"></a>00339         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ab1ce22088e636ff9cd28e7c5d062471a">completionOn</a> = <span class="keyword">false</span>;
<a name="l00340"></a>00340         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a8df4f47c35084abc7bf31d65b248c5be">completions</a> = null;
<a name="l00341"></a>00341         
<a name="l00342"></a>00342         <span class="comment">// We are now going to initialize our state based on the type of</span>
<a name="l00343"></a>00343         <span class="comment">// text being edited.</span>
<a name="l00344"></a>00344         <span class="keywordflow">switch</span> (attribute.inputType &amp; EditorInfo.TYPE_MASK_CLASS) {
<a name="l00345"></a>00345             <span class="keywordflow">case</span> EditorInfo.TYPE_CLASS_NUMBER:
<a name="l00346"></a>00346             <span class="keywordflow">case</span> EditorInfo.TYPE_CLASS_DATETIME:
<a name="l00347"></a>00347                 <span class="comment">// Numbers and dates default to the symbols keyboard, with</span>
<a name="l00348"></a>00348                 <span class="comment">// no extra features.</span>
<a name="l00349"></a>00349                 <span class="comment">//mCurKeyboard = mSymbolsKeyboard;</span>
<a name="l00350"></a>00350                 <span class="keywordflow">break</span>;
<a name="l00351"></a>00351                 
<a name="l00352"></a>00352             <span class="keywordflow">case</span> EditorInfo.TYPE_CLASS_PHONE:
<a name="l00353"></a>00353                 <span class="comment">// Phones will also default to the symbols keyboard, though</span>
<a name="l00354"></a>00354                 <span class="comment">// often you will want to have a dedicated phone keyboard.</span>
<a name="l00355"></a>00355                 <span class="comment">//mCurKeyboard = mSymbolsKeyboard;</span>
<a name="l00356"></a>00356                 <span class="keywordflow">break</span>;
<a name="l00357"></a>00357                 
<a name="l00358"></a>00358             <span class="keywordflow">case</span> EditorInfo.TYPE_CLASS_TEXT:
<a name="l00359"></a>00359                 <span class="comment">// This is general text editing.  We will default to the</span>
<a name="l00360"></a>00360                 <span class="comment">// normal alphabetic keyboard, and assume that we should</span>
<a name="l00361"></a>00361                 <span class="comment">// be doing predictive text (showing candidates as the</span>
<a name="l00362"></a>00362                 <span class="comment">// user types).</span>
<a name="l00363"></a>00363                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ac95c3e131d61264247ea2f40b3bd4991">curKeyboard</a> = <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a57cdeb14386f227d3588cf221f32e8d0">padKeyboard</a>;
<a name="l00364"></a>00364                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a84134f9987fa827825135caaac882b26">predictionOn</a> = <span class="keyword">true</span>;
<a name="l00365"></a>00365                 
<a name="l00366"></a>00366                 <span class="comment">// We now look for a few special variations of text that will</span>
<a name="l00367"></a>00367                 <span class="comment">// modify our behavior.</span>
<a name="l00368"></a>00368                 <span class="keywordtype">int</span> variation = attribute.inputType &amp;  EditorInfo.TYPE_MASK_VARIATION;
<a name="l00369"></a>00369                 <span class="keywordflow">if</span> (variation == EditorInfo.TYPE_TEXT_VARIATION_PASSWORD ||
<a name="l00370"></a>00370                         variation == EditorInfo.TYPE_TEXT_VARIATION_VISIBLE_PASSWORD) {
<a name="l00371"></a>00371                     <span class="comment">// Do not display predictions / what the user is typing</span>
<a name="l00372"></a>00372                     <span class="comment">// when they are entering a password.</span>
<a name="l00373"></a>00373                     <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a84134f9987fa827825135caaac882b26">predictionOn</a> = <span class="keyword">false</span>;
<a name="l00374"></a>00374                 }
<a name="l00375"></a>00375                 
<a name="l00376"></a>00376                 <span class="keywordflow">if</span> (variation == EditorInfo.TYPE_TEXT_VARIATION_EMAIL_ADDRESS 
<a name="l00377"></a>00377                         || variation == EditorInfo.TYPE_TEXT_VARIATION_URI
<a name="l00378"></a>00378                         || variation == EditorInfo.TYPE_TEXT_VARIATION_FILTER) {
<a name="l00379"></a>00379                     <span class="comment">// Our predictions are not useful for e-mail addresses</span>
<a name="l00380"></a>00380                     <span class="comment">// or URIs.</span>
<a name="l00381"></a>00381                     <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a84134f9987fa827825135caaac882b26">predictionOn</a> = <span class="keyword">false</span>;
<a name="l00382"></a>00382                 }
<a name="l00383"></a>00383                 
<a name="l00384"></a>00384                 <span class="keywordflow">if</span> ((attribute.inputType&amp;EditorInfo.TYPE_TEXT_FLAG_AUTO_COMPLETE) != 0) {
<a name="l00385"></a>00385                     <span class="comment">// If this is an auto-complete text view, then our predictions</span>
<a name="l00386"></a>00386                     <span class="comment">// will not be shown and instead we will allow the editor</span>
<a name="l00387"></a>00387                     <span class="comment">// to supply their own.  We only show the editor&apos;s</span>
<a name="l00388"></a>00388                     <span class="comment">// candidates when in fullscreen mode, otherwise relying</span>
<a name="l00389"></a>00389                     <span class="comment">// own it displaying its own UI.</span>
<a name="l00390"></a>00390                     <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a84134f9987fa827825135caaac882b26">predictionOn</a> = <span class="keyword">false</span>;
<a name="l00391"></a>00391                     <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ab1ce22088e636ff9cd28e7c5d062471a">completionOn</a> = isFullscreenMode();
<a name="l00392"></a>00392                 }
<a name="l00393"></a>00393                 
<a name="l00394"></a>00394                 <span class="comment">// We also want to look at the current state of the editor</span>
<a name="l00395"></a>00395                 <span class="comment">// to decide whether our alphabetic keyboard should start out</span>
<a name="l00396"></a>00396                 <span class="comment">// shifted.</span>
<a name="l00397"></a>00397                 <span class="comment">//updateShiftKeyState(attribute);</span>
<a name="l00398"></a>00398                 <span class="keywordflow">break</span>;
<a name="l00399"></a>00399                 
<a name="l00400"></a>00400             <span class="keywordflow">default</span>:
<a name="l00401"></a>00401                 <span class="comment">// For all unknown input types, default to the alphabetic</span>
<a name="l00402"></a>00402                 <span class="comment">// keyboard with no special features.</span>
<a name="l00403"></a>00403                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ac95c3e131d61264247ea2f40b3bd4991">curKeyboard</a> = <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a57cdeb14386f227d3588cf221f32e8d0">padKeyboard</a>;
<a name="l00404"></a>00404                 <span class="comment">//updateShiftKeyState(attribute);</span>
<a name="l00405"></a>00405         }
<a name="l00406"></a>00406         
<a name="l00407"></a>00407         <span class="comment">// Update the label on the enter key, depending on what the application</span>
<a name="l00408"></a>00408         <span class="comment">// says it will do.</span>
<a name="l00409"></a>00409         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ac95c3e131d61264247ea2f40b3bd4991">curKeyboard</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1LatinKeyboard.html#adf5bb7364614b740d3360ed911912f31">setImeOptions</a>(getResources(), attribute.imeOptions);
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411 
<a name="l00416"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1b167f4b94b905a354b0713f15ef4a92">00416</a>     @Override <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1b167f4b94b905a354b0713f15ef4a92">onFinishInput</a>() {
<a name="l00417"></a>00417         super.onFinishInput();
<a name="l00418"></a>00418 
<a name="l00419"></a>00419         <span class="comment">// Clear current composing text and candidates.</span>
<a name="l00420"></a>00420         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.setLength(0);
<a name="l00421"></a>00421         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a428fc59e616bef0e75c866ddece97a70">updateCandidates</a>();
<a name="l00422"></a>00422         
<a name="l00423"></a>00423         <span class="comment">// We only hide the candidates window when finishing input on</span>
<a name="l00424"></a>00424         <span class="comment">// a particular editor, to avoid popping the underlying application</span>
<a name="l00425"></a>00425         <span class="comment">// up and down if the user is entering text into the bottom of</span>
<a name="l00426"></a>00426         <span class="comment">// its window.</span>
<a name="l00427"></a>00427         setCandidatesViewShown(<span class="keyword">false</span>);
<a name="l00428"></a>00428         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a> != null) {
<a name="l00429"></a>00429             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1PadView.html#a4e5d62bdc50d1efae84f0cde40beeb51">closing</a>();
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431     }
<a name="l00432"></a>00432     
<a name="l00436"></a>00436     @Override
<a name="l00437"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a372883c8da0f8e41f6acb0d169fc5b6e">00437</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a372883c8da0f8e41f6acb0d169fc5b6e">onUpdateSelection</a>(<span class="keywordtype">int</span> oldSelStart, <span class="keywordtype">int</span> oldSelEnd, <span class="keywordtype">int</span> newSelStart, <span class="keywordtype">int</span> newSelEnd, <span class="keywordtype">int</span> candidatesStart, <span class="keywordtype">int</span> candidatesEnd) {
<a name="l00438"></a>00438         super.onUpdateSelection(oldSelStart, oldSelEnd, newSelStart, newSelEnd, candidatesStart, candidatesEnd);
<a name="l00439"></a>00439         
<a name="l00440"></a>00440         <span class="comment">// If the current selection in the text view changes, we should</span>
<a name="l00441"></a>00441         <span class="comment">// clear whatever candidate text we have.</span>
<a name="l00442"></a>00442         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length() &gt; 0 
<a name="l00443"></a>00443                         &amp;&amp; (newSelStart != candidatesEnd || newSelEnd != candidatesEnd)) {
<a name="l00444"></a>00444             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.setLength(0);
<a name="l00445"></a>00445             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a428fc59e616bef0e75c866ddece97a70">updateCandidates</a>();
<a name="l00446"></a>00446             InputConnection ic = getCurrentInputConnection();
<a name="l00447"></a>00447             <span class="keywordflow">if</span> (ic != null) {
<a name="l00448"></a>00448                 ic.finishComposingText();
<a name="l00449"></a>00449             }
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452 
<a name="l00459"></a>00459     @Override
<a name="l00460"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5e02e524ed9e962644d630cc0facda16">00460</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5e02e524ed9e962644d630cc0facda16">onDisplayCompletions</a>(CompletionInfo[] completion_infos) {
<a name="l00461"></a>00461         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ab1ce22088e636ff9cd28e7c5d062471a">completionOn</a>) {
<a name="l00462"></a>00462             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a8df4f47c35084abc7bf31d65b248c5be">completions</a> = completion_infos;
<a name="l00463"></a>00463             <span class="keywordflow">if</span> (completion_infos == null) {
<a name="l00464"></a>00464                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a761d3a5ee4b8830684c9fe03641b6a62">setSuggestions</a>(null, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00465"></a>00465                 <span class="keywordflow">return</span>;
<a name="l00466"></a>00466             }
<a name="l00467"></a>00467             
<a name="l00468"></a>00468             List&lt;String&gt; stringList = <span class="keyword">new</span> ArrayList&lt;String&gt;();
<a name="l00469"></a>00469             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;(completion_infos != null ? completion_infos.length : 0); i++) {
<a name="l00470"></a>00470                 CompletionInfo ci = completion_infos[i];
<a name="l00471"></a>00471                 <span class="keywordflow">if</span> (ci != null) stringList.add(ci.getText().toString());
<a name="l00472"></a>00472             }
<a name="l00473"></a>00473             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a761d3a5ee4b8830684c9fe03641b6a62">setSuggestions</a>(stringList, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00474"></a>00474         }
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476     
<a name="l00482"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a25b3410857b8a7b81ad09b2a76ca352c">00482</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a25b3410857b8a7b81ad09b2a76ca352c">translateKeyDown</a>(<span class="keywordtype">int</span> keyCode, KeyEvent event) {
<a name="l00483"></a>00483         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5fcd0c226a96c4fb7549fba822b49d2a">metaState</a> = MetaKeyKeyListener.handleKeyDown(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5fcd0c226a96c4fb7549fba822b49d2a">metaState</a>, keyCode, event);
<a name="l00484"></a>00484         <span class="keywordtype">int</span> c = <span class="keyword">event</span>.getUnicodeChar(MetaKeyKeyListener.getMetaState(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5fcd0c226a96c4fb7549fba822b49d2a">metaState</a>));
<a name="l00485"></a>00485         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5fcd0c226a96c4fb7549fba822b49d2a">metaState</a> = MetaKeyKeyListener.adjustMetaAfterKeypress(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5fcd0c226a96c4fb7549fba822b49d2a">metaState</a>);
<a name="l00486"></a>00486         InputConnection ic = getCurrentInputConnection();
<a name="l00487"></a>00487         <span class="keywordflow">if</span> (c == 0 || ic == null) {
<a name="l00488"></a>00488             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00489"></a>00489         }
<a name="l00490"></a>00490         
<a name="l00491"></a>00491         <span class="comment">//boolean dead = false;</span>
<a name="l00492"></a>00492         <span class="keywordflow">if</span> ((c &amp; KeyCharacterMap.COMBINING_ACCENT) != 0) {
<a name="l00493"></a>00493             <span class="comment">//dead = true;</span>
<a name="l00494"></a>00494             c = c &amp; KeyCharacterMap.COMBINING_ACCENT_MASK;
<a name="l00495"></a>00495         }
<a name="l00496"></a>00496         
<a name="l00497"></a>00497         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length() &gt; 0) {
<a name="l00498"></a>00498             <span class="keywordtype">char</span> accent = <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.charAt(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length() -1 );
<a name="l00499"></a>00499             <span class="keywordtype">int</span> composed = KeyEvent.getDeadChar(accent, c);
<a name="l00500"></a>00500 
<a name="l00501"></a>00501             <span class="keywordflow">if</span> (composed != 0) {
<a name="l00502"></a>00502                 c = composed;
<a name="l00503"></a>00503                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.setLength(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length()-1);
<a name="l00504"></a>00504             }
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506         
<a name="l00507"></a>00507         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a6bf7a6751794c5bf24f686cbf94d7ebf">onKey</a>(c, null);
<a name="l00508"></a>00508         
<a name="l00509"></a>00509         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00510"></a>00510     }
<a name="l00511"></a>00511     
<a name="l00517"></a>00517     @Override
<a name="l00518"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a999c8827bbffc0388be05c9e87e2ac49">00518</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a999c8827bbffc0388be05c9e87e2ac49">onKeyDown</a>(<span class="keywordtype">int</span> keyCode, KeyEvent event) {
<a name="l00519"></a>00519         <span class="keywordflow">switch</span> (keyCode) {
<a name="l00520"></a>00520             <span class="keywordflow">case</span> KeyEvent.KEYCODE_BACK:
<a name="l00521"></a>00521                 <span class="comment">// The InputMethodService already takes care of the back</span>
<a name="l00522"></a>00522                 <span class="comment">// key for us, to dismiss the input method if it is shown.</span>
<a name="l00523"></a>00523                 <span class="comment">// However, our keyboard could be showing a pop-up window</span>
<a name="l00524"></a>00524                 <span class="comment">// that back should dismiss, so we first allow it to do that.</span>
<a name="l00525"></a>00525                 <span class="keywordflow">if</span> (event.getRepeatCount() == 0 &amp;&amp; <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a> != null) {
<a name="l00526"></a>00526                     <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.handleBack()) {
<a name="l00527"></a>00527                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00528"></a>00528                     }
<a name="l00529"></a>00529                 }
<a name="l00530"></a>00530                 <span class="keywordflow">break</span>;                
<a name="l00531"></a>00531             <span class="keywordflow">case</span> KeyEvent.KEYCODE_DEL:
<a name="l00532"></a>00532                 <span class="comment">// Special handling of the delete key: if we currently are</span>
<a name="l00533"></a>00533                 <span class="comment">// composing text for the user, we want to modify that instead</span>
<a name="l00534"></a>00534                 <span class="comment">// of let the application to the delete itself.</span>
<a name="l00535"></a>00535                 <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length() &gt; 0) {
<a name="l00536"></a>00536                     <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a6bf7a6751794c5bf24f686cbf94d7ebf">onKey</a>(Keyboard.KEYCODE_DELETE, null);
<a name="l00537"></a>00537                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00538"></a>00538                 }
<a name="l00539"></a>00539                 <span class="keywordflow">break</span>;                
<a name="l00540"></a>00540             <span class="keywordflow">case</span> KeyEvent.KEYCODE_ENTER:
<a name="l00541"></a>00541                 <span class="comment">// Let the underlying text editor always handle these.</span>
<a name="l00542"></a>00542                 <span class="keywordflow">return</span> <span class="keyword">false</span>;                
<a name="l00543"></a>00543             <span class="keywordflow">default</span>:
<a name="l00544"></a>00544                 <span class="comment">// For all other keys, if we want to do transformations on</span>
<a name="l00545"></a>00545                 <span class="comment">// text being entered with a hard keyboard, we need to process</span>
<a name="l00546"></a>00546                 <span class="comment">// it and do the appropriate action.</span>
<a name="l00547"></a>00547                 <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a6807180ab4641e86ea2c94e01ead09a8">PROCESS_HARD_KEYS</a>) {
<a name="l00548"></a>00548                     <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a84134f9987fa827825135caaac882b26">predictionOn</a> &amp;&amp; <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a25b3410857b8a7b81ad09b2a76ca352c">translateKeyDown</a>(keyCode, event)) {
<a name="l00549"></a>00549                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00550"></a>00550                     }
<a name="l00551"></a>00551                 }
<a name="l00552"></a>00552         }
<a name="l00553"></a>00553         <span class="keywordflow">return</span> super.onKeyDown(keyCode, event);
<a name="l00554"></a>00554     }
<a name="l00555"></a>00555 
<a name="l00561"></a>00561     @Override
<a name="l00562"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3d39e17d6aa63cc1b2564dcb2022c8ec">00562</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3d39e17d6aa63cc1b2564dcb2022c8ec">onKeyUp</a>(<span class="keywordtype">int</span> keyCode, KeyEvent event) {
<a name="l00563"></a>00563         <span class="comment">// If we want to do transformations on text being entered with a hard</span>
<a name="l00564"></a>00564         <span class="comment">// keyboard, we need to process the up events to update the meta key</span>
<a name="l00565"></a>00565         <span class="comment">// state we are tracking.</span>
<a name="l00566"></a>00566         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a6807180ab4641e86ea2c94e01ead09a8">PROCESS_HARD_KEYS</a>) {
<a name="l00567"></a>00567             <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a84134f9987fa827825135caaac882b26">predictionOn</a>) {
<a name="l00568"></a>00568                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5fcd0c226a96c4fb7549fba822b49d2a">metaState</a> = MetaKeyKeyListener.handleKeyUp(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5fcd0c226a96c4fb7549fba822b49d2a">metaState</a>, keyCode, event);
<a name="l00569"></a>00569             }
<a name="l00570"></a>00570         }
<a name="l00571"></a>00571         <span class="keywordflow">return</span> super.onKeyUp(keyCode, event);
<a name="l00572"></a>00572     }
<a name="l00573"></a>00573 
<a name="l00577"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3f0ca3d6a23ac27b9ad1b2578078512e">00577</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3f0ca3d6a23ac27b9ad1b2578078512e">commitTyped</a>(InputConnection inputConnection) {
<a name="l00578"></a>00578         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length() &gt; 0) {
<a name="l00579"></a>00579             inputConnection.commitText(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>, <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length());
<a name="l00580"></a>00580             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.setLength(0);
<a name="l00581"></a>00581             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a428fc59e616bef0e75c866ddece97a70">updateCandidates</a>();
<a name="l00582"></a>00582         }
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584     
<a name="l00588"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a0cc6d7c254ce701f73f5852bafe294b4">00588</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a0cc6d7c254ce701f73f5852bafe294b4">isAlphabet</a>(<span class="keywordtype">int</span> code) {
<a name="l00589"></a>00589         <span class="keywordflow">if</span> (java.lang.Character.isLetter(code)) {
<a name="l00590"></a>00590             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00591"></a>00591         } <span class="keywordflow">else</span> {
<a name="l00592"></a>00592             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00593"></a>00593         }
<a name="l00594"></a>00594     }
<a name="l00595"></a>00595     
<a name="l00599"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#acaadb74527ea7fc306cdd571b9a25097">00599</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#acaadb74527ea7fc306cdd571b9a25097">keyDownUp</a>(<span class="keywordtype">int</span> keyEventCode) {
<a name="l00600"></a>00600         getCurrentInputConnection().sendKeyEvent(<span class="keyword">new</span> KeyEvent(KeyEvent.ACTION_DOWN, keyEventCode));
<a name="l00601"></a>00601         getCurrentInputConnection().sendKeyEvent(<span class="keyword">new</span> KeyEvent(KeyEvent.ACTION_UP, keyEventCode));
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603     
<a name="l00607"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a2711e357f6251b532e7d0bde79cadfdf">00607</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a2711e357f6251b532e7d0bde79cadfdf">sendKey</a>(<span class="keywordtype">int</span> keyCode) {
<a name="l00608"></a>00608         <span class="keywordflow">switch</span> (keyCode) {
<a name="l00609"></a>00609             <span class="keywordflow">case</span> <span class="charliteral">&apos;\n&apos;</span>:
<a name="l00610"></a>00610                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#acaadb74527ea7fc306cdd571b9a25097">keyDownUp</a>(KeyEvent.KEYCODE_ENTER);
<a name="l00611"></a>00611                 <span class="keywordflow">break</span>;
<a name="l00612"></a>00612             <span class="keywordflow">default</span>:
<a name="l00613"></a>00613                 <span class="keywordflow">if</span> (keyCode &gt;= <span class="charliteral">&apos;0&apos;</span> &amp;&amp; keyCode &lt;= <span class="charliteral">&apos;9&apos;</span>) {
<a name="l00614"></a>00614                     <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#acaadb74527ea7fc306cdd571b9a25097">keyDownUp</a>(keyCode - <span class="charliteral">&apos;0&apos;</span> + KeyEvent.KEYCODE_0);
<a name="l00615"></a>00615                 } <span class="keywordflow">else</span> {
<a name="l00616"></a>00616                     getCurrentInputConnection().commitText(String.valueOf((<span class="keywordtype">char</span>) keyCode), 1);
<a name="l00617"></a>00617                 }
<a name="l00618"></a>00618                 <span class="keywordflow">break</span>;
<a name="l00619"></a>00619         }
<a name="l00620"></a>00620     }
<a name="l00621"></a>00621 
<a name="l00626"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a6bf7a6751794c5bf24f686cbf94d7ebf">00626</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a6bf7a6751794c5bf24f686cbf94d7ebf">onKey</a>(<span class="keywordtype">int</span> primaryCode, <span class="keywordtype">int</span>[] keyCodes) {
<a name="l00627"></a>00627         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aeef9b5d4fa9f314d5bf17331645ba93b">isWordSeparator</a>(primaryCode)) {
<a name="l00628"></a>00628             <span class="comment">// Handle separator</span>
<a name="l00629"></a>00629             <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length() &gt; 0) {
<a name="l00630"></a>00630                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3f0ca3d6a23ac27b9ad1b2578078512e">commitTyped</a>(getCurrentInputConnection());
<a name="l00631"></a>00631             }
<a name="l00632"></a>00632             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a2711e357f6251b532e7d0bde79cadfdf">sendKey</a>(primaryCode);
<a name="l00633"></a>00633         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (primaryCode == Keyboard.KEYCODE_DELETE) {
<a name="l00634"></a>00634             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a629b38e45bc795d46cb7ce1c79bc1def">handleBackspace</a>();
<a name="l00635"></a>00635         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (primaryCode == Keyboard.KEYCODE_CANCEL) {
<a name="l00636"></a>00636             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a4287014b4f552f286e8b51ef841573b1">handleClose</a>();
<a name="l00637"></a>00637             <span class="keywordflow">return</span>;
<a name="l00638"></a>00638         } <span class="keywordflow">else</span> {
<a name="l00639"></a>00639             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5b7f7f06b8e6f5eb9797725b5d814f5c">handleCharacter</a>(primaryCode, keyCodes);
<a name="l00640"></a>00640         }
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642 
<a name="l00643"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aaa0fc01a36b17c423c223f0dce23390d">00643</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aaa0fc01a36b17c423c223f0dce23390d">onText</a>(CharSequence text) {
<a name="l00644"></a>00644         InputConnection ic = getCurrentInputConnection();
<a name="l00645"></a>00645         <span class="keywordflow">if</span> (ic == null) {
<a name="l00646"></a>00646                 <span class="keywordflow">return</span>;
<a name="l00647"></a>00647         }
<a name="l00648"></a>00648         ic.beginBatchEdit();
<a name="l00649"></a>00649         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length() &gt; 0) {
<a name="l00650"></a>00650             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3f0ca3d6a23ac27b9ad1b2578078512e">commitTyped</a>(ic);
<a name="l00651"></a>00651         }
<a name="l00652"></a>00652         ic.commitText(text, 0);
<a name="l00653"></a>00653         ic.endBatchEdit();
<a name="l00654"></a>00654     }
<a name="l00655"></a>00655 
<a name="l00661"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a428fc59e616bef0e75c866ddece97a70">00661</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a428fc59e616bef0e75c866ddece97a70">updateCandidates</a>() {
<a name="l00662"></a>00662         <span class="keywordflow">if</span> (!<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ab1ce22088e636ff9cd28e7c5d062471a">completionOn</a>) {
<a name="l00663"></a>00663             <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length() &gt; 0) {
<a name="l00664"></a>00664                 ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();
<a name="l00665"></a>00665                 list.add(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.toString());
<a name="l00666"></a>00666                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a761d3a5ee4b8830684c9fe03641b6a62">setSuggestions</a>(list, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00667"></a>00667             } <span class="keywordflow">else</span> {
<a name="l00668"></a>00668                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a761d3a5ee4b8830684c9fe03641b6a62">setSuggestions</a>(null, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00669"></a>00669             }
<a name="l00670"></a>00670         }
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672     
<a name="l00673"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a761d3a5ee4b8830684c9fe03641b6a62">00673</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a761d3a5ee4b8830684c9fe03641b6a62">setSuggestions</a>(List&lt;String&gt; suggestions, <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a8df4f47c35084abc7bf31d65b248c5be">completions</a>,
<a name="l00674"></a>00674             <span class="keywordtype">boolean</span> typedWordValid) {
<a name="l00675"></a>00675         <span class="keywordflow">if</span> (suggestions != null &amp;&amp; suggestions.size() &gt; 0) {
<a name="l00676"></a>00676             setCandidatesViewShown(<span class="keyword">true</span>);
<a name="l00677"></a>00677         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isExtractViewShown()) {
<a name="l00678"></a>00678             setCandidatesViewShown(<span class="keyword">true</span>);
<a name="l00679"></a>00679         }
<a name="l00680"></a>00680         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af7d4919c3faf26a9459310f8102d4d80">candidateView</a> != null) {
<a name="l00681"></a>00681             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af7d4919c3faf26a9459310f8102d4d80">candidateView</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1CandidateView.html#a3b2b7c5d303e3e6c25dd7458d61b2a20">setSuggestions</a>(suggestions, completions, typedWordValid);
<a name="l00682"></a>00682         }
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684     
<a name="l00688"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a629b38e45bc795d46cb7ce1c79bc1def">00688</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a629b38e45bc795d46cb7ce1c79bc1def">handleBackspace</a>() {
<a name="l00689"></a>00689         <span class="keyword">final</span> <span class="keywordtype">int</span> length = <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length();
<a name="l00690"></a>00690         <span class="keywordflow">if</span> (length &gt; 1) {
<a name="l00691"></a>00691             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.delete(length - 1, length);
<a name="l00692"></a>00692             getCurrentInputConnection().setComposingText(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>, 1);
<a name="l00693"></a>00693             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a428fc59e616bef0e75c866ddece97a70">updateCandidates</a>();
<a name="l00694"></a>00694         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length &gt; 0) {
<a name="l00695"></a>00695             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.setLength(0);
<a name="l00696"></a>00696             getCurrentInputConnection().commitText(<span class="stringliteral">&quot;&quot;</span>, 0);
<a name="l00697"></a>00697             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a428fc59e616bef0e75c866ddece97a70">updateCandidates</a>();
<a name="l00698"></a>00698         } <span class="keywordflow">else</span> {
<a name="l00699"></a>00699             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#acaadb74527ea7fc306cdd571b9a25097">keyDownUp</a>(KeyEvent.KEYCODE_DEL);
<a name="l00700"></a>00700         }
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702     
<a name="l00706"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5b7f7f06b8e6f5eb9797725b5d814f5c">00706</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5b7f7f06b8e6f5eb9797725b5d814f5c">handleCharacter</a>(<span class="keywordtype">int</span> primaryCode, <span class="keywordtype">int</span>[] keyCodes) {
<a name="l00707"></a>00707         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a0cc6d7c254ce701f73f5852bafe294b4">isAlphabet</a>(primaryCode) &amp;&amp; <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a84134f9987fa827825135caaac882b26">predictionOn</a>) {
<a name="l00708"></a>00708             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.append((<span class="keywordtype">char</span>) primaryCode);
<a name="l00709"></a>00709             getCurrentInputConnection().setComposingText(<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>, 1);
<a name="l00710"></a>00710             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a428fc59e616bef0e75c866ddece97a70">updateCandidates</a>();
<a name="l00711"></a>00711         } <span class="keywordflow">else</span> {
<a name="l00712"></a>00712             getCurrentInputConnection().commitText(String.valueOf((<span class="keywordtype">char</span>) primaryCode), 1);
<a name="l00713"></a>00713         }
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715 
<a name="l00719"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a4287014b4f552f286e8b51ef841573b1">00719</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a4287014b4f552f286e8b51ef841573b1">handleClose</a>() {
<a name="l00720"></a>00720         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3f0ca3d6a23ac27b9ad1b2578078512e">commitTyped</a>(getCurrentInputConnection());
<a name="l00721"></a>00721         requestHideSelf(0);
<a name="l00722"></a>00722         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a1dd0d971c8e7acd463435307af0b6bcd">padView</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1PadView.html#a4e5d62bdc50d1efae84f0cde40beeb51">closing</a>();
<a name="l00723"></a>00723     }
<a name="l00724"></a>00724     
<a name="l00725"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aedc68ffb6a0f14256976a0cfdb5a8a3d">00725</a>     <span class="keyword">private</span> String <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aedc68ffb6a0f14256976a0cfdb5a8a3d">getWordSeparators</a>() {
<a name="l00726"></a>00726         <span class="keywordflow">return</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a23ac28ca44ad5920e88c7671b7a9f2d1">wordSeparators</a>;
<a name="l00727"></a>00727     }
<a name="l00728"></a>00728     
<a name="l00729"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aeef9b5d4fa9f314d5bf17331645ba93b">00729</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aeef9b5d4fa9f314d5bf17331645ba93b">isWordSeparator</a>(<span class="keywordtype">int</span> code) {
<a name="l00730"></a>00730         String separators = <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aedc68ffb6a0f14256976a0cfdb5a8a3d">getWordSeparators</a>();
<a name="l00731"></a>00731         <span class="keywordflow">return</span> separators.contains(String.valueOf((<span class="keywordtype">char</span>)code));
<a name="l00732"></a>00732     }
<a name="l00733"></a>00733 
<a name="l00737"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a6e2e375b97933b90f110199def80abfe">00737</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a6e2e375b97933b90f110199def80abfe">pickDefaultCandidate</a>() {
<a name="l00738"></a>00738         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ada3cca347b6d9a39b3fb4d008d90dac8">pickSuggestionManually</a>(0);
<a name="l00739"></a>00739     }
<a name="l00740"></a>00740     
<a name="l00745"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ada3cca347b6d9a39b3fb4d008d90dac8">00745</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ada3cca347b6d9a39b3fb4d008d90dac8">pickSuggestionManually</a>(<span class="keywordtype">int</span> index) {
<a name="l00746"></a>00746         <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#ab1ce22088e636ff9cd28e7c5d062471a">completionOn</a> &amp;&amp; <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a8df4f47c35084abc7bf31d65b248c5be">completions</a> != null &amp;&amp; index &gt;= 0 &amp;&amp; index &lt; <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a8df4f47c35084abc7bf31d65b248c5be">completions</a>.length) {
<a name="l00747"></a>00747             CompletionInfo ci = <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a8df4f47c35084abc7bf31d65b248c5be">completions</a>[index];
<a name="l00748"></a>00748             getCurrentInputConnection().commitCompletion(ci);
<a name="l00749"></a>00749             <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af7d4919c3faf26a9459310f8102d4d80">candidateView</a> != null) {
<a name="l00750"></a>00750                 <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#af7d4919c3faf26a9459310f8102d4d80">candidateView</a>.<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1CandidateView.html#aa3d1a8c9206e423a3f532ef599b28cf4">clear</a>();
<a name="l00751"></a>00751             }
<a name="l00752"></a>00752         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adb09682281dc4daa50613d97d28c6dfd">composingText</a>.length() &gt; 0) {
<a name="l00753"></a>00753             <span class="comment">// If we were generating candidate suggestions for the current</span>
<a name="l00754"></a>00754             <span class="comment">// text, we would commit one of them here.  But for this sample,</span>
<a name="l00755"></a>00755             <span class="comment">// we will just commit the current text.</span>
<a name="l00756"></a>00756             <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a3f0ca3d6a23ac27b9ad1b2578078512e">commitTyped</a>(getCurrentInputConnection());
<a name="l00757"></a>00757         }
<a name="l00758"></a>00758     }
<a name="l00759"></a>00759     
<a name="l00760"></a>00760         @Override
<a name="l00761"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5a27dd14331c21af3031ffcd38d802f4">00761</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a5a27dd14331c21af3031ffcd38d802f4">swipeRight</a>() {}
<a name="l00762"></a>00762     
<a name="l00763"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aab0d09eae40077fbdb87a21566a266ea">00763</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aab0d09eae40077fbdb87a21566a266ea">swipeLeft</a>() {
<a name="l00764"></a>00764         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a629b38e45bc795d46cb7ce1c79bc1def">handleBackspace</a>();
<a name="l00765"></a>00765     }
<a name="l00766"></a>00766 
<a name="l00767"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aa35f0cbc95d0b5623c29229e3a8ee2e5">00767</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#aa35f0cbc95d0b5623c29229e3a8ee2e5">swipeDown</a>() {
<a name="l00768"></a>00768         <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a4287014b4f552f286e8b51ef841573b1">handleClose</a>();
<a name="l00769"></a>00769     }
<a name="l00770"></a>00770 
<a name="l00771"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a76b1e0dc03f0b6d2641cf60325dee604">00771</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#a76b1e0dc03f0b6d2641cf60325dee604">swipeUp</a>() {}
<a name="l00772"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#abb77d1d11f616d5980ea16858a6b6190">00772</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#abb77d1d11f616d5980ea16858a6b6190">onPress</a>(<span class="keywordtype">int</span> primaryCode) { }
<a name="l00773"></a><a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adf013e6d8fc9b5d0e567fe93f5f6511a">00773</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classch_1_1zhaw_1_1ba10__bsha__1_1_1ime_1_1HandwritingIME.html#adf013e6d8fc9b5d0e567fe93f5f6511a">onRelease</a>(<span class="keywordtype">int</span> primaryCode) {}
<a name="l00774"></a>00774 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Fri May 21 01:42:15 2010 for BA10-bsha-1 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
